---
title:  "SECTION6 ì¿ ë²„ë„¤í‹°ìŠ¤"
excerpt: "ì¿ ë²„ë„¤í‹°ìŠ¤"

categories:
  - docker&kubenetes
tags:
  - [Blog, Docker, Kubenetes]

toc: true
toc_sticky: true
 
date: 2023-04-12
last_modified_at: 2023-04-12
---
í‘... ë…¸ì…˜ì—ì„œ ê·¸ëŒ€ë¡œ ì˜®ê¸°ëŠ” ê±´, ë„ˆë¬´ ë¬´ë¦¬í•œ ì‘ì—…ì¸ ê±° ê°™ë‹¤... ì¢€ ë” íš¨ìœ¨ì ì¸ ë°©ë²•ì´ ì—†ì„ê¹Œ

# ì¿ ë²„ë„¤í‹°ìŠ¤

### ì¿ ë²„ë„¤í‹°ìŠ¤ ì „ì²´ ê°œìš”

![image](https://user-images.githubusercontent.com/62383521/231242153-4b775db3-341b-4dc0-bb8d-d9414438e9a3.png) ì»¨íŠ¸ë¡¤ Plane(ë§ˆìŠ¤í„° ë…¸ë“œ) -&gt; ì›Œì»¤ë…¸ë“œë¡œ ëª…ë ¹ì´ ì „ë‹¬ëœë‹¤.

### ì˜¤ë¸Œì íŠ¸

```
ì˜¤ë¸Œì íŠ¸ ëª©ë¡ í™•ì¸
kubectl api-resources

íŠ¹ì • ì˜¤ë¸Œì íŠ¸ ì„¤ëª…
kubectl explain pod
```

### í¬ë“œ ìƒì„±

```
kubectl apply -f nginx-pod.yaml
```

### í¬ë“œ í™•ì¸

```
kubectl get pdos

í¬ë“œ ì •ë³´ í™•ì¸
kubectl describe pods {PODS_NAME}

í¬ë“œ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í™•ì¸
kubectl exec -it my-nginx-pod bash 

í¬ë“œ ë¡œê·¸ í™•ì¸ 
kubectl logs my-nginx-pod

í¬ë“œ ì‚­ì œ
kubectl delete pod {POD_NAME}

```

ğŸ‹ **YAML íŒŒì¼ì—ì„œ - ë¥¼ ì“°ëŠ” ê±´ ì—¬ëŸ¬ ê°œì˜ í•˜ìœ„í•­ëª©ì´ ìˆìŒì„ ì˜ë¯¸**

### ì»¨í…Œì´ë„ˆ ì ‘ì†

```
kubectl exec -it my-ngnix-pod -c ubuntu-sidecar-container bash

```

### ì—¬ëŸ¬ ê°œ ë¦¬ì†ŒìŠ¤ ì •ì˜

![image](https://user-images.githubusercontent.com/62383521/231242194-f65741fd-8b26-452c-836b-a5c2b8d2bd63.png)

**í•œ ë²ˆì— ì—¬ëŸ¬ ê°œ í¬ë“œë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì¸ ì‘ì—…ì´ë‹¤.**

**í¬ë“œê°€ ìƒì„±ëœ ë…¸ë“œì— ì¥ì• ê°€ ìƒê²¨ë„ í¬ë“œëŠ” ë‹¤ë¥¸ ë…¸ë“œì—ì„œ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.**

# Replicaset

-   ì •í•´ì§„ ìˆ˜ì˜ ë™ì¼í•œ í¬ë“œê°€ í•­ìƒ ë™ì¼í•˜ê²Œ ê´€ë¦¬í•©ë‹ˆë‹¤.

```
##### YAML ì‘ì„±ë²• #####
spec.replicas = ë™ì¼í•œ í¬ë“œë¥¼ ëª‡ ê°œ ìœ ì§€í•  ê±´ì§€ ì„¤ì •
spec.templates = í¬ë“œë¥¼ ì‚¬ìš©í•  ë•Œ ìƒì„±í•  templatesë¥¼ ì •ì˜
```

### ì„¤ì •ëœ labelì˜ ë¦¬ì†ŒìŠ¤ í•„í„°ë§

```
kubectl get pods --show-labels

kubectl get pods -l app
```

### kubectl edit

```
kubectl edit pods {PODNAME} YAMLì—ì„œ ì§€ì •í•˜ì§€ ì•Šì€ ì˜µì…˜ê¹Œì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```

# K8S ì¢€ë¹„ í´ëŸ¬ìŠ¤í„° ì§€ìš°ëŠ” ë²•

ì˜ëª»í•´ì„œ í•œ ë²ˆ ë§Œë“  k8s í´ëŸ¬ìŠ¤í„°ê°€ ì§€ì›Œì§€ì§€ ì•ŠëŠ”ë‹¤â€¦ !

ê·¸ëŸ´ ë•ŒëŠ”,

IAMì—ì„œ ì•¡ì„¸ìŠ¤ ê´€ë¦¬ â†’ ì—­í• ì—ì„œ k8s master node / k8s worker nodeë¥¼ ì§€ìš°ê³  ec2ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¢…ë£Œí•˜ë©´ ë‹¤ì‹œ ì‚´ì•„ë‚˜ì§€ ì•ŠëŠ”ë‹¤ !!

![image](https://user-images.githubusercontent.com/62383521/231242214-4fc043a3-2470-46e0-a4ca-35d31888fad0.png)

# Deployment

**ğŸ‹ ë ˆí”Œë¦¬ì¹´ì…‹ìœ¼ë¡œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°ì˜ ì»¨í…Œì´ë„ˆë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ì§€ë§Œ, â€ë ˆí”Œë¦¬ì¹´ì…‹ê³¼ í¬ë“œì˜ ì •ë³´ë¥¼**

**ë””í”Œë¡œì´ë¨¼íŠ¸(DEPLOYMENT)ë¼ëŠ” ì˜¤ë¸Œì íŠ¸ì— ì •ì˜í•œë‹¤.â€**

### Deploymentì˜ yaml ì˜ˆì‹œ

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-nginx-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-nginx
  template:
    metadata:
      name: my-nginx-pod
      labels:
        app: my-nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.10
        ports:
        - containerPort: 80
```

### ë””í”Œë¡œì´ë¨¼íŠ¸ ì‚­ì œ

```
ë°°í¬í•˜ëŠ” ë ˆí”Œë¦¬ì¹´ì…‹ê³¼ íŒŒë“œê°€ ì‚­ì œëœë‹¤.
kubectl delete deploy my-nginx-deployment
```

## ë””í”Œë¡œì´ë¨¼íŠ¸ ì—…ë°ì´íŠ¸

### ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

**ğŸ‹ â€œì• í”Œë¦¬ì¼€ì´ì…˜ ì—…ë°ì´íŠ¸ì™€ ë°°í¬ë¥¼ í¸í•˜ê²Œ í•˜ê¸° ìœ„í•´ì„œì´ë‹¤.â€**

ì—…ë°ì´íŠ¸ ì‹œ, ë ˆí”Œë¦¬ì¹´ì…‹ì˜ ë³€ê²½ ì‚¬í•­ì„ ì €ì¥í•˜ëŠ” ë¦¬ë¹„ì „(revision)ì„ ë‚¨ê²¨ ë¡¤ë°± ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ê³ , ë¬´ì¤‘ë‹¨ ì„œë¹„ìŠ¤ì‹œ í¬ë“œì˜ ë¡¤ë§ ì—…ë°ì´íŠ¸ì˜ ì „ëµì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```
ì–´í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ ì—…ë°ì´íŠ¸
kubectl apply -f deployment-nginx.yaml --record

ì´ë¯¸ì§€ ë³€ê²½ ì—…ë°ì´íŠ¸ ì‹œ
kubectl set image deployment my-nginx-deployment nginx=nginx:1.11 --record
```

### ë¦¬ë¹„ì „ ì •ë³´

**ğŸ‹ â€œë””í”Œë¡œì´ë¨¼íŠ¸ëŠ” í¬ë“œì˜ ì •ë³´ê°€ ë³€ê²½ë˜ì–´ ì—…ë°ì´íŠ¸ ë°œìƒ ì‹œ â†’ ì´ì „ì˜ ì •ë³´ë¥¼ ì €ì¥í•œë‹¤.â€**

```
ë¦¬ë¹„ì „ ì •ë³´ë¥¼ ì—´ëŒ
kubectl rollout history deployment my-nginx-deployment
```

**record true ì˜µì…˜ìœ¼ë¡œ ë””í”Œë¡œì´ë¨¼íŠ¸ë¥¼ ë³€ê²½í•˜ë©´ ë³€ê²½ ì‚¬í•­ì„ ì €ì¥, í•´ë‹¹ ë²„ì „ì˜ ë ˆí”Œë¦¬ì¹´ì…‹ì„ ë³´ì¡´**

### ë¦¬ë¹„ì „ ë¡¤ë°± ì‹œ

```
ì´ì „ ë²„ì „ì˜ ë¦¬ë¹„ì „ìœ¼ë¡œ ë¡¤ë°± ì‹œ --to-revisionì—ëŠ” ë˜ëŒë¦¬ë ¤ëŠ” ë¦¬ë¹„ì „ì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥
kubectl rollout undo deployment my-nginx-deployment --to-revision=1
```

### ë””í”Œë¡œì´ë¨¼íŠ¸ ì •ë³´ ì¶œë ¥

```
kubectl describe deploy my-nginx-deployment
```

# ì„œë¹„ìŠ¤(Service)

```
í¬ë“œì˜ IPë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•
kubectl get pods -o wide

```

### ì„œë¹„ìŠ¤ì˜ ì¢…ë¥˜

-   Cluster IP íƒ€ì… : ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€ì—ì„œë§Œ í¬ë“œë“¤ì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©, ì™¸ë¶€ë¡œ í¬ë“œë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” í¬ë“œì— ì í•©.
-   NodePort íƒ€ì… : í¬ë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í¬íŠ¸ë¥¼ í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë…¸ë“œì— ì ìš©, ì™¸ë¶€ì—ì„œ í¬ë“œë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ íƒ€ì….
-   LoadBalancer íƒ€ì… : í´ë¼ìš°ë“œ í”Œë«í¼ì— ì œê³µí•˜ëŠ” ë¡œë“œ ë°¸ëŸ°ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹í•˜ì—¬ í¬ë“œì— ì—°ê²°. NodePort íƒ€ì…ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤. ì¼ë°˜ì ìœ¼ë¡œ AWS, GCP ë“±ê³¼ ê°™ì€ í´ë¼ìš°ë“œ í”Œë«í¼ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥.

**ğŸ‹ í¬ë“œë¥¼ ë‚´ë¶€ì—ì„œë§Œ ì ‘ì†í•˜ê³  ì‹¶ë‹¤. â†’ Cluster IP ì™¸ë¶€ì—ì„œë„ í¬ë“œë¥¼ ì ‘ê·¼í•˜ê³  ì‹¶ìœ¼ë©´ â†’ NodePort ì‹¤ì œ ìš´ì˜ í™˜ê²½**

**â†’ LoadBalancer**

## ClusterIP íƒ€ì…ì˜ ì„œë¹„ìŠ¤

### YAML íŒŒì¼ í˜•ì‹

```
apiVersion: v1
kind: Service
metadata:
  name: hostname-svc-clusterip
spec:
  ports:
    - name: web-port
      port: 8080 
      targetPort: 80 //í¬ë“œ í…œí”Œë¦¿ê³¼ ê°™ì€ í¬íŠ¸ ì•„ì´í”¼ í•„ìš” 
//Ip:8080->  Container port 80
			
  selector:
    app: webserver
  type: ClusterIP //ì„œë¹„ìŠ¤ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€ ClusterIP/ NodePort /LoadBalancer
```

### Cluster IP ê°œìš”

![image](https://user-images.githubusercontent.com/62383521/231242255-5bfaa184-439c-49e3-a312-b11f3dcafea1.png)

## NodePort íƒ€ì…ì˜ ì„œë¹„ìŠ¤

### YAML íŒŒì¼ í˜•ì‹

```
apiVersion: v1
kind: Service
metadata:
  name: hostname-svc-nodeport
spec:
  ports:
    - name: web-port
      port: 8080
      targetPort: 80 // PublicIP:~~ -> ServicePort 8080 -> Container port 80
			nodePort: ~~ // nodePortì˜ í¬íŠ¸ë²ˆí˜¸ë¥¼ ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤. ë³´í†µì€30000 ~ 32768 ì‚¬ì´
  selector:
    app: webserver
  type: NodePort
```

### NodePort ê°œìš”

![image](https://user-images.githubusercontent.com/62383521/231242265-62fbcde6-7543-4549-b02d-ec7cbc2985dd.png)

ğŸ‹ **NodePortëŠ” ìë™ìœ¼ë¡œ ClusterIP ë˜í•œ ìƒì„±í•˜ì—¬, ë‚´/ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤ !**

### LoadBalancer íƒ€ì…ì˜ ì„œë¹„ìŠ¤

### YAML íŒŒì¼ í˜•ì‹

```
apiVersion: v1
kind: Service
metadata:
  name: hostname-svc-lb
spec:
  ports:
    - name: web-port
      port: 80
      targetPort: 80
  selector:
    app: webserver
  type: LoadBalancer
```

ì„œë¹„ìŠ¤ ìƒì„± ì‹œ â†’ External-IP í•­ëª©ì´ ì¶”ê°€ , port ë²ˆí˜¸ì™€ ê°™ì´ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ì— ì ‘ê·¼

### LoadBalancer ê°œìš”

# ì„œë¹„ìŠ¤ ì‚­ì œ

```
ì´ì „ ë²„ì „ì˜ ë¦¬ë¹„ì „ìœ¼ë¡œ ë¡¤ë°± ì‹œ --to-revisionì—ëŠ” ë˜ëŒë¦¬ë ¤ëŠ” ë¦¬ë¹„ì „ì˜ ë²ˆí˜¸ë¥¼ ì…ë ¥
kubectl rollout undo deployment my-nginx-deployment --to-revision=1
```

### ë””í”Œë¡œì´ë¨¼íŠ¸ ì •ë³´ ì¶œë ¥

```
kubectl describe deploy my-nginx-deployment
```

# ì„œë¹„ìŠ¤(Service)

```
í¬ë“œì˜ IPë¥¼ í™•ì¸í•˜ëŠ” ë°©ë²•
kubectl get pods -o wide

```

### ì„œë¹„ìŠ¤ì˜ ì¢…ë¥˜

-   Cluster IP íƒ€ì… : ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€ì—ì„œë§Œ í¬ë“œë“¤ì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©, ì™¸ë¶€ë¡œ í¬ë“œë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” í¬ë“œì— ì í•©.
-   NodePort íƒ€ì… : í¬ë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í¬íŠ¸ë¥¼ í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë…¸ë“œì— ì ìš©, ì™¸ë¶€ì—ì„œ í¬ë“œë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ íƒ€ì….
-   LoadBalancer íƒ€ì… : í´ë¼ìš°ë“œ í”Œë«í¼ì— ì œê³µí•˜ëŠ” ë¡œë“œ ë°¸ëŸ°ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹í•˜ì—¬ í¬ë“œì— ì—°ê²°. NodePort íƒ€ì…ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤. ì¼ë°˜ì ìœ¼ë¡œ AWS, GCP ë“±ê³¼ ê°™ì€ í´ë¼ìš°ë“œ í”Œë«í¼ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥.

<aside> ğŸ‹ í¬ë“œë¥¼ ë‚´ë¶€ì—ì„œë§Œ ì ‘ì†í•˜ê³  ì‹¶ë‹¤. â†’ Cluster IP ì™¸ë¶€ì—ì„œë„ í¬ë“œë¥¼ ì ‘ê·¼í•˜ê³  ì‹¶ìœ¼ë©´ â†’ NodePort ì‹¤ì œ ìš´ì˜ í™˜ê²½ â†’ LoadBalancer

</aside>

## ClusterIP íƒ€ì…ì˜ ì„œë¹„ìŠ¤

### YAML íŒŒì¼ í˜•ì‹

```
apiVersion: v1
kind: Service
metadata:
  name: hostname-svc-clusterip
spec:
  ports:
    - name: web-port
      port: 8080 
      targetPort: 80 //í¬ë“œ í…œí”Œë¦¿ê³¼ ê°™ì€ í¬íŠ¸ ì•„ì´í”¼ í•„ìš” 
//Ip:8080->  Container port 80
			
  selector:
    app: webserver
  type: ClusterIP //ì„œë¹„ìŠ¤ê°€ ì–´ë–¤ íƒ€ì…ì¸ì§€ ClusterIP/ NodePort /LoadBalancer
```

### Cluster IP ê°œìš”

## NodePort íƒ€ì…ì˜ ì„œë¹„ìŠ¤

### YAML íŒŒì¼ í˜•ì‹

```
apiVersion: v1
kind: Service
metadata:
  name: hostname-svc-nodeport
spec:
  ports:
    - name: web-port
      port: 8080
      targetPort: 80 // PublicIP:~~ -> ServicePort 8080 -> Container port 80
			nodePort: ~~ // nodePortì˜ í¬íŠ¸ë²ˆí˜¸ë¥¼ ì§€ì •í•  ìˆ˜ë„ ìˆë‹¤. ë³´í†µì€30000 ~ 32768 ì‚¬ì´
  selector:
    app: webserver
  type: NodePort
```

### NodePort ê°œìš”

ğŸ‹ **NodePortëŠ” ìë™ìœ¼ë¡œ ClusterIP ë˜í•œ ìƒì„±í•˜ì—¬, ë‚´/ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥í•˜ë‹¤ !**

### LoadBalancer íƒ€ì…ì˜ ì„œë¹„ìŠ¤

### YAML íŒŒì¼ í˜•ì‹

```
apiVersion: v1
kind: Service
metadata:
  name: hostname-svc-lb
spec:
  ports:
    - name: web-port
      port: 80
      targetPort: 80
  selector:
    app: webserver
  type: LoadBalancer
```

ì„œë¹„ìŠ¤ ìƒì„± ì‹œ â†’ External-IP í•­ëª©ì´ ì¶”ê°€ , port ë²ˆí˜¸ì™€ ê°™ì´ ì‚¬ìš©í•˜ì—¬ ì„œë¹„ìŠ¤ì— ì ‘ê·¼

### LoadBalancer ê°œìš”

![image](https://user-images.githubusercontent.com/62383521/231242294-839f8b95-f6dd-4611-a3e4-24da483eb885.png)

# ì„œë¹„ìŠ¤ ì‚­ì œ

```
kubectl delete -f hostname-svc-lb.yaml
```