---
title:  "SECTION8 ì¸ê·¸ë ˆìŠ¤"
excerpt: "ì¿ ë²„ë„¤í‹°ìŠ¤ ì¸ê·¸ë ˆìŠ¤"

categories:
  - docker&kubenetes
tags:
  - [Blog, Docker, Kubenetes]

toc: true
toc_sticky: true
 
date: 2023-04-11
last_modified_at: 2023-04-11
---



# SECTION8 ì¸ê·¸ë ˆìŠ¤

> **ì™¸ë¶€ì—ì„œ ë‚´ë¶€ë¡œ í–¥í•˜ëŠ” íŠ¸ë˜í”½**
> 

**ì¸ê·¸ë ˆìŠ¤ ì˜¤ë¸Œì íŠ¸ì˜ ê¸°ëŠ¥**

1. ì™¸ë¶€ ìš”ì²­ì˜ ë¼ìš°íŒ…
    
    /apple /apple/red ê°™ì€ íŠ¹ì • ê²½ë¡œë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì— ì–´ë– í•œ ì„œë¹„ìŠ¤ë¥¼ ì „ë‹¬í• ì§€ ì •ì˜í•˜ëŠ” ë¼ìš°íŒ… ê·œì¹™
    
2. ê°€ìƒ í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ì˜ ìš”ì²­ ì²˜ë¦¬
    
    ê°™ì€ IPë¥¼ ëŒ€ìƒìœ¼ë¡œ ê°ê° ë‹¤ë¥¸ ë„ë©”ì¸ ì´ë¦„ìœ¼ë¡œ ìš”ì²­ í–ˆì„ ë•Œ, ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ì§€ ì •ì˜
    
3. SSL/TLS ë³´ì•ˆ ì—°ê²° ì²˜ë¦¬
    
    ì—¬ëŸ¬ ê°œì˜ ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë¼ìš°íŒ…í•  ë•Œ , ë³´ì•ˆ ì—°ê²°ì„ ìœ„í•œ ì¸ì¦ì„œë¥¼ ì‰½ê²Œ ì ìš©
    

### ì¸ê·¸ë ˆìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 

ê¸°ì¡´ ë””í”Œë¡œì´ë¨¼íŠ¸ì—ë‹¤ê°€ NodePortë‚˜ LoadBalancerë¥¼ ì ìš©í•´ë„ ìœ ì‚¬ ê¸°ëŠ¥ì„ êµ¬í˜„ 


![Untitled](https://user-images.githubusercontent.com/62383521/231191005-42e8606f-6c8d-404e-9e62-22f35e093d6c.png)

í•˜ì§€ë§Œ  SSL/TLS ë³´ì•ˆ ì—°ê²° ë° ì ‘ê·¼ ë„ë©”ì¸ ë° í´ë¼ì´ì–¸íŠ¸ ìƒíƒœì— ê¸°ë°˜í•œ ë¼ìš°íŒ…ì„ êµ¬í˜„í•˜ë ¤ë©´ ê° ì„œë¹„ìŠ¤ì™€ ë””í”Œë¡œì´ë¨¼íŠ¸ì— ëŒ€í•´ ì¼ì¼ì´ ì„¤ì •ì„ í•´ì•¼í•œë‹¤.

**ì¸ê·¸ë ˆìŠ¤ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´, URL ì—”ë“œí¬ì¸íŠ¸ í•˜ë‚˜ë¡œ ë²ˆê±°ë¡œì›€ì„ ì—†ì•¨ ìˆ˜ ìˆë‹¤.**


![Untitled 1](https://user-images.githubusercontent.com/62383521/231191085-1a084cb6-7897-4f54-88f1-d3a627dce4f8.png)
<aside>
ğŸ‹ **ë¼ìš°íŒ… ì •ì˜ë‚˜ ë³´ì•ˆ ì—°ê²°ë“±ê³¼ ê°™ì€ ì„¸ë¶€ ì„¤ì •ì€ ì„œë¹„ìŠ¤ì™€ ë””í”Œë¡œì´ë¨¼íŠ¸ê°€ ì•„ë‹Œ ì¸ê·¸ë ˆìŠ¤ì— ì˜í•´ ìˆ˜í–‰ëœë‹¤.**

</aside>

## ì¸ê·¸ë ˆìŠ¤ êµ¬ì¡°

### ì¸ê·¸ë ˆìŠ¤ ëª©ë¡

```jsx
kubectl get ingress
kubectl get ing
```

### ì¸ê·¸ë ˆìŠ¤ ìƒì„±

```jsx
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ingress-example
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    kubernetes.io/ingress.class: "nginx"
spec:
  rules:
  - host: alicek106.example.com                   # [1] 
    http:
      paths:
      - path: /echo-hostname                     # [2]
        pathType: Prefix
        backend: 
          service: 
            name: hostname-service               # [3]
            port: 
              number: 80
```

- host : í•´ë‹¹ ë„ë©”ì¸ ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ê·œì¹™ ì •ì˜
- path: í•´ë‹¹ ê²½ë¡œì— ë“¤ì–´ì˜¨ ìš”ì²­ì„ ì–´ëŠ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬í•  ê²ƒì¸ì§€ ì •ì˜. /echo-hostnameì´ë¼ëŠ” ê²½ë¡œì˜ ìš”ì²­ì„ backendì— ì •ì˜ëœ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬
- serviceName, servicePort: pathë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì´ ì „ë‹¬ë  ì„œë¹„ìŠ¤ì™€ í¬íŠ¸. ìœ„ ì˜ˆì‹œì—ì„œëŠ” /echo-hostname ì´ë¼ëŠ” ê²½ë¡œë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ hostname-serviceì˜ 80ë²ˆ í¬íŠ¸ë¡œ ì „ë‹¬

<aside>
ğŸ‹ ì¸ê·¸ë ˆìŠ¤ë¥¼ ìƒì„±í•´ë„, ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ê·œì¹™ì„ ì •ì˜í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ì´ë¯€ë¡œ ì•„ë¬´ ì¼ë„ ë°œìƒí•˜ì§€ ì•ŠìŒ. ì¸ê·¸ë ˆìŠ¤ëŠ” ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ë¼ê³  í•˜ëŠ” íŠ¹ìˆ˜í•œ ì„œë²„ì— ì ìš©í•´ì•¼ë§Œ ê·¸ ê·œì¹™ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

</aside>

# ì¿ ë²„ë„¤í‹°ìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬

1. NGINX ì›¹ ì„œë²„ ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬
2. KONG
3. êµ¬ê¸€ ì¿ ë²„ë„¤í‹°ìŠ¤ ì—”ì§„

### NGINX ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ ì„¤ì¹˜

```jsx

```

> í•œ ë²ˆì— ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ìœ„í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ì„¤ì¹˜í•œë‹¤. ingress-nginxë¼ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— NGINX ì›¹ ì„œë²„ ë””í”Œë¡œì´ë¨¼íŠ¸ì™€ ì»¨í”¼ê·¸ë§µë“¤ì„ ì„¤ì¹˜ (ì„œë¹„ìŠ¤ëŠ” ë¡œë“œë°¸ëŸ°ì„œ)
> 

![Untitled 2](https://user-images.githubusercontent.com/62383521/231191121-47f785b9-a80b-4a23-a7c4-79923c04ed42.png)

## ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ ë™ì‘ ê°œìš”

![Untitled 3](https://user-images.githubusercontent.com/62383521/231191160-360c3d95-c1bf-40a9-9dcd-462e78f1404c.png)

ì¸ê·¸ë ˆìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ìë™ìœ¼ë¡œ ë¡œë“œí•˜ê³ , Nginx ì›¹ ì„œë²„ì— ì ìš©í•œë‹¤.

**ë°”ì´íŒ¨ìŠ¤**

## Nginx ì¸ê·¸ë ˆìŠ¤  ì»¨íŠ¸ë¡¤ëŸ¬ SSL/TLS ë³´ì•ˆ ì—°ê²° ì ìš©

1.******************ì¸ì¦ì„œì™€ ë¹„ë°€ í‚¤ ìƒì„±******************

```jsx
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout tls.key -out tls.crt -subj "/CN=alicek106.example.com/0=alicek106"
CNì—ëŠ” Nginx ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ PUBLIC DNS ì´ë¦„ì„ ì—°ê²°í•´ì•¼ í•œë‹¤.\
tls.keyë¼ëŠ” í‚¤ì™€ tls.crt ë¼ëŠ” ì¸ì¦ì„œê°€ ìƒì„±ëœë‹¤.
```

2.********TLSíƒ€ì…ì˜ ì‹œí¬ë¦¿ ìƒì„±********

```jsx
í˜„ì¬ ë””ë ‰í„°ë¦¬ì— tls.keyì™€ tls.crtê°€ ìˆì„ ê²½ìš°
kubectl create secret tls tls-secret --key tls.key --cert tls.crt
```

3.**********************************************ì¸ê·¸ë ˆìŠ¤ ì„¤ì •ì— TLSì˜µì…˜ ì¶”ê°€********************************************** 

YAML íŒŒì¼ ì‘ì„± í˜•ì‹

```jsx
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: ingress-example
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    kubernetes.io/ingress.class: "nginx"
spec:
  tls:
  - hosts:
    - alicek106.example.com            # ì—¬ëŸ¬ë¶„ì˜ ë„ë©”ì¸ ì´ë¦„ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
    secretName: tls-secret
  rules:
  - host: alicek106.example.com          # ì—¬ëŸ¬ë¶„ì˜ ë„ë©”ì¸ ì´ë¦„ì„ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.
    http:
      paths:
      - path: /echo-hostname
        pathType: Prefix
        backend: 
          service: 
            name: hostname-service
            port: 
              number: 80
```

4.**HTTPS ìš”ì²­ ë³´ë‚´ê¸°**

```jsx
#curlì˜ -k ì˜µì…˜ì€ ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì¸ì¦ì„œë¡œ ë³´ì•ˆ ì—°ê²°ì„ í•˜ê¸° ìœ„í•¨
curl https://alicek106.example.com/echo-hostname -k
httpë¡œ í•´ë„ ìë™ìœ¼ë¡œ httpsë¡œ ë°˜í™˜ì´ ëœë‹¤ why? ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìë™ìœ¼ë¡œ httpsë¡œ
ë¦¬ë‹¤ì´ë ‰íŠ¸ í•˜ëŠ” ì£¼ì„ì¸ ssl-redirectë¥¼ trueë¡œ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
```